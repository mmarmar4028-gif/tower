<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>–ë–∞—à–Ω—è</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      touch-action: none;
    }

    body {
      background-color: #f9f9f9;
      font-family: 'Segoe UI', sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      overflow: hidden;
    }

    #game-container {
      position: relative;
      width: 300px;
      height: 600px;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      overflow: hidden;
    }

    #game-canvas {
      display: block;
      background: #fff;
    }

    #ui {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      padding: 12px;
      display: flex;
      justify-content: space-between;
      color: #c00;
      font-weight: bold;
      font-size: 18px;
    }

    #restart-btn {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: #e63946;
      color: white;
      border: none;
      border-radius: 24px;
      padding: 8px 20px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      box-shadow: 0 2px 6px rgba(230, 57, 70, 0.4);
      transition: background 0.2s;
    }

    #restart-btn:hover {
      background: #d90429;
    }

    #restart-btn:active {
      transform: translate(-50%, 2px);
    }
  </style>
</head>
<body>
  <div id="game-container">
    <div id="ui">
      <div>–°—á—ë—Ç: <span id="score">0</span></div>
      <div>–£—Ä–æ–≤–µ–Ω—å: <span id="level">1</span></div>
    </div>
    <canvas id="game-canvas" width="300" height="600"></canvas>
    <button id="restart-btn">üîÑ –ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
  </div>

  <script>
    const canvas = document.getElementById('game-canvas');
    const ctx = canvas.getContext('2d');
    const scoreEl = document.getElementById('score');
    const levelEl = document.getElementById('level');
    const restartBtn = document.getElementById('restart-btn');

    // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–≥—Ä—ã
    const COLORS = ['#e63946', '#d90429', '#f15a5a', '#ff6b6b'];
    const BASE_WIDTH = 200;
    const BLOCK_HEIGHT = 30;
    const BASE_SPEED = 2;
    const SPEED_INCREMENT = 0.5;
    const MAX_SPEED = 12;

    let gameState = {
      score: 0,
      level: 1,
      speed: BASE_SPEED,
      direction: 1, // 1 ‚Äî –≤–ø—Ä–∞–≤–æ, -1 ‚Äî –≤–ª–µ–≤–æ
      gameRunning: true,
      blocks: []
    };

    // –ë–∞–∑–æ–≤—ã–π –±–ª–æ–∫ (–æ—Å–Ω–æ–≤–∞–Ω–∏–µ)
    let baseBlock = {
      x: (canvas.width - BASE_WIDTH) / 2,
      y: canvas.height - BLOCK_HEIGHT,
      width: BASE_WIDTH,
      height: BLOCK_HEIGHT
    };

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
    function initGame() {
      gameState = {
        score: 0,
        level: 1,
        speed: BASE_SPEED,
        direction: 1,
        gameRunning: true,
        blocks: []
      };
      baseBlock = {
        x: (canvas.width - BASE_WIDTH) / 2,
        y: canvas.height - BLOCK_HEIGHT,
        width: BASE_WIDTH,
        height: BLOCK_HEIGHT
      };
      scoreEl.textContent = '0';
      levelEl.textContent = '1';
      requestAnimationFrame(gameLoop);
    }

    // –°–æ–∑–¥–∞—ë–º –Ω–æ–≤—ã–π –±–ª–æ–∫
    function createBlock() {
      const lastBlock = gameState.blocks.length > 0 
        ? gameState.blocks[gameState.blocks.length - 1] 
        : baseBlock;

      const newBlock = {
        x: lastBlock.x,
        y: lastBlock.y - BLOCK_HEIGHT,
        width: lastBlock.width,
        height: BLOCK_HEIGHT,
        velocity: gameState.speed * gameState.direction
      };

      gameState.blocks.push(newBlock);
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏ —Ç–µ–∫—É—â–µ–≥–æ –≤–µ—Ä—Ö–Ω–µ–≥–æ –±–ª–æ–∫–∞
    function updateFallingBlock() {
      if (gameState.blocks.length === 0) return;
      const block = gameState.blocks[gameState.blocks.length - 1];
      block.x += block.velocity;

      // –û—Ç—Å–∫–æ–∫ –æ—Ç —Å—Ç–µ–Ω–æ–∫
      if (block.x <= 0 || block.x + block.width >= canvas.width) {
        block.velocity *= -1;
        gameState.direction *= -1;
      }
    }

    // –§–∏–∫—Å–∞—Ü–∏—è –±–ª–æ–∫–∞ (–µ—Å–ª–∏ –∫–ª–∏–∫/—Ç–∞–ø –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ—Å–ª–µ –ø–∞—É–∑—ã)
    function placeBlock() {
      if (gameState.blocks.length === 0 || !gameState.gameRunning) return;

      const movingBlock = gameState.blocks[gameState.blocks.length - 1];
      const targetBlock = gameState.blocks.length > 1 
        ? gameState.blocks[gameState.blocks.length - 2] 
        : baseBlock;

      // –ü–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ –ø–æ X
      const overlapStart = Math.max(movingBlock.x, targetBlock.x);
      const overlapEnd = Math.min(movingBlock.x + movingBlock.width, targetBlock.x + targetBlock.width);
      const overlap = overlapEnd - overlapStart;

      if (overlap <= 0) {
        // –ü—Ä–æ–≤–∞–ª
        gameState.gameRunning = false;
        return;
      }

      // –û–±—Ä–µ–∑–∞–µ–º –±–ª–æ–∫ –ø–æ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏—é
      movingBlock.x = overlapStart;
      movingBlock.width = overlap;

      // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á—ë—Ç –∏ —É—Ä–æ–≤–µ–Ω—å
      gameState.score++;
      scoreEl.textContent = gameState.score;

      if (gameState.score % 3 === 0) {
        gameState.level++;
        levelEl.textContent = gameState.level;
        gameState.speed = Math.min(BASE_SPEED + (gameState.level - 1) * SPEED_INCREMENT, MAX_SPEED);
      }

      // –°–æ–∑–¥–∞—ë–º —Å–ª–µ–¥—É—é—â–∏–π –±–ª–æ–∫
      setTimeout(createBlock, 500);
    }

    // –†–µ–Ω–¥–µ—Ä
    function render() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // –†–∏—Å—É–µ–º –±–∞–∑—É
      ctx.fillStyle = COLORS[0];
      ctx.fillRect(baseBlock.x, baseBlock.y, baseBlock.width, baseBlock.height);

      // –†–∏—Å—É–µ–º –±–ª–æ–∫–∏
      gameState.blocks.forEach((block, i) => {
        ctx.fillStyle = COLORS[(i + 1) % COLORS.length];
        ctx.fillRect(block.x, block.y, block.width, block.height);
      });
    }

    // –û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª –∏–≥—Ä—ã
    let lastTime = 0;
    function gameLoop(timestamp) {
      const deltaTime = timestamp - lastTime;
      lastTime = timestamp;

      if (gameState.gameRunning) {
        if (gameState.blocks.length === 0) {
          createBlock();
        } else {
          updateFallingBlock();
        }
        render();
        requestAnimationFrame(gameLoop);
      } else {
        render(); // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
      }
    }

    // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: –∫–ª–∏–∫/—Ç–∞–ø ‚Äî –ø–æ—Å—Ç–∞–≤–∏—Ç—å –±–ª–æ–∫
    canvas.addEventListener('click', () => {
      if (gameState.gameRunning && gameState.blocks.length > 0) {
        placeBlock();
      }
    });

    // –î–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö: —Ç–∞–ø
    canvas.addEventListener('touchstart', (e) => {
      e.preventDefault();
      if (gameState.gameRunning && gameState.blocks.length > 0) {
        placeBlock();
      }
    });

    restartBtn.addEventListener('click', initGame);

    // –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã
    initGame();
  </script>
</body>
</html>
